<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Color Critters — Worlds 1 & 2</title>
<style>
  :root{--bg:#f0f8ff;--card:#fff;--accent:#ffd54a}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#123;text-align:center}
  header{padding:18px}
  h1{margin:0;font-size:1.4rem}
  p#instructions{margin:8px 12px 0;color:#246}
  .game-area{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;margin:18px}
  .critter,.target{width:140px;height:140px;border-radius:16px;margin:12px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;color:#fff;touch-action:none}
  .item{width:96px;height:96px;border-radius:12px;margin:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.12);touch-action:none}
  .emoji{font-size:48px}
  #message{min-height:28px;margin-top:10px;font-size:20px}
  .controls{margin:18px}
  button{padding:10px 14px;font-size:16px;margin:6px;border-radius:8px;border:0;background:#246;color:#fff;cursor:pointer}
  button.secondary{background:#fff;color:#246;border:2px solid #246}
  #retryBtn{display:none}
  #world2Unlock,#completion{display:none;margin-top:18px;font-size:20px}
  #trophy{font-size:96px;display:none;margin-top:12px;animation:pop .9s ease}
  @keyframes pop{0%{transform:scale(.4);opacity:0}100%{transform:scale(1);opacity:1}}
  @media(max-width:480px){.critter,.target{width:110px;height:110px;font-size:16px}.item{width:78px;height:78px}}
</style>
</head>
<body>
<header>
  <h1>🎨 Color Critters</h1>
  <p id="instructions">Match the correct item — tap or drag the white card to the matching critter.</p>
</header>

<main>
  <div class="game-area" id="critters" aria-live="polite"></div>
  <div class="game-area" id="items" aria-hidden="false"></div>
  <div id="message" role="status"></div>

  <div id="world2Unlock">🌈 You unlocked World 2! Tap <strong>Start World 2</strong>.</div>
  <div id="completion">🎉 Amazing! You finished all worlds!</div>
  <div id="trophy">🏆🌈</div>

  <div class="controls">
    <button id="prevBtn">⬅️ Back</button>
    <button id="nextBtn">Next ➡️</button>
    <button id="retryBtn" class="secondary">🔁 Try Again</button>
    <button id="startWorld2Btn" class="secondary">Start World 2 🌎</button>
  </div>
</main>

<!-- sounds -->
<audio id="correctSound" src="https://www.soundjay.com/misc/sounds/applause-8.mp3" preload="auto"></audio>
<audio id="wrongSound" src="https://www.soundjay.com/human/sounds/boo-1.mp3" preload="auto"></audio>
<!-- animal sounds will be per-stage -->

<script>
// full 30-stage data with emojis (cartoon style) and sound URLs for animals
const stages = [
  // World 1 - Colors (1-5)
  {type:'color', instructions:'Match the color: Drag the card to the critter.', critters:[{id:'red', label:'Red Critter', color:'#e53935', emoji:'🟠'},{id:'blue', label:'Blue Critter', color:'#1e88e5', emoji:'🔵'}], items:[{id:'red', label:'Red', color:'#e53935'},{id:'blue', label:'Blue', color:'#1e88e5'}]},
  {type:'color', instructions:'Match the color!', critters:[{id:'green', label:'Green Critter', color:'#43a047', emoji:'🟢'},{id:'yellow', label:'Yellow Critter', color:'#fdd835', emoji:'🟡'}], items:[{id:'green',label:'Green',color:'#43a047'},{id:'yellow',label:'Yellow',color:'#fdd835'}]},
  {type:'color', instructions:'Match the color!', critters:[{id:'purple', label:'Purple Critter', color:'#8e24aa', emoji:'🟣'},{id:'orange', label:'Orange Critter', color:'#fb8c00', emoji:'🟠'}], items:[{id:'purple',label:'Purple',color:'#8e24aa'},{id:'orange',label:'Orange',color:'#fb8c00'}]},
  {type:'color', instructions:'Match the color!', critters:[{id:'pink', label:'Pink Critter', color:'#ec407a', emoji:'🌸'},{id:'teal', label:'Teal Critter', color:'#009688', emoji:'🔷'}], items:[{id:'pink',label:'Pink',color:'#ec407a'},{id:'teal',label:'Teal',color:'#009688'}]},
  {type:'color', instructions:'Match the color!', critters:[{id:'brown', label:'Brown Critter', color:'#8d6e63', emoji:'🟤'},{id:'gray', label:'Gray Critter', color:'#90a4ae', emoji:'⚪️'}], items:[{id:'brown',label:'Brown',color:'#8d6e63'},{id:'gray',label:'Gray',color:'#90a4ae'}]},
  // World 1 - Shapes (6-10)
  {type:'shape', instructions:'Match the shapes! Drag the shape to its outline.', critters:[{id:'circle',shape:'circle'},{id:'square',shape:'square'},{id:'triangle',shape:'triangle'}], items:[{id:'circle',shape:'circle'},{id:'square',shape:'square'},{id:'triangle',shape:'triangle'}]},
  {type:'shape', instructions:'Match the shapes!', critters:[{id:'circle',shape:'circle'},{id:'triangle',shape:'triangle'}], items:[{id:'circle',shape:'circle'},{id:'triangle',shape:'triangle'}]},
  {type:'shape', instructions:'Match the shapes!', critters:[{id:'square',shape:'square'},{id:'circle',shape:'circle'}], items:[{id:'square',shape:'square'},{id:'circle',shape:'circle'}]},
  {type:'shape', instructions:'Match the shapes!', critters:[{id:'star',shape:'star'},{id:'heart',shape:'heart'}], items:[{id:'star',shape:'star'},{id:'heart',shape:'heart'}]},
  {type:'shape', instructions:'Match the shapes!', critters:[{id:'diamond',shape:'diamond'},{id:'pentagon',shape:'pentagon'}], items:[{id:'diamond',shape:'diamond'},{id:'pentagon',shape:'pentagon'}]},
  // World 1 - Animal sounds (11-15)
  {type:'animal', instructions:'Listen: tap to play the sound, then drag the white card with the name to the correct animal.', critters:[{id:'dog',label:'Dog',emoji:'🐶',sound:'https://www.soundjay.com/animal/dog-barking-1.mp3'},{id:'cat',label:'Cat',emoji:'🐱',sound:'https://www.soundjay.com/animal/cat-meow-1.mp3'}], items:[{id:'dog',label:'Dog'},{id:'cat',label:'Cat'}]},
  {type:'animal', instructions:'Match the sound!', critters:[{id:'cow',label:'Cow',emoji:'🐮',sound:'https://www.soundjay.com/animal/cow-moo1.mp3'},{id:'sheep',label:'Sheep',emoji:'🐑',sound:'https://www.soundjay.com/animal/sheep-bleat1.mp3'}], items:[{id:'cow',label:'Cow'},{id:'sheep',label:'Sheep'}]},
  {type:'animal', instructions:'Match the sound!', critters:[{id:'lion',label:'Lion',emoji:'🦁',sound:'https://www.soundjay.com/animal/lion-roar-1.mp3'},{id:'elephant',label:'Elephant',emoji:'🐘',sound:'https://www.soundjay.com/animal/elephant-trumpet-1.mp3'}], items:[{id:'lion',label:'Lion'},{id:'elephant',label:'Elephant'}]},
  {type:'animal', instructions:'Match the sound!', critters:[{id:'bird',label:'Bird',emoji:'🐦',sound:'https://www.soundjay.com/animal/bird-chirp-1.mp3'},{id:'frog',label:'Frog',emoji:'🐸',sound:'https://www.soundjay.com/animal/frog-drearily-1.mp3'}], items:[{id:'bird',label:'Bird'},{id:'frog',label:'Frog'}]},
  {type:'animal', instructions:'Match the sound!', critters:[{id:'duck',label:'Duck',emoji:'🦆',sound:'https://www.soundjay.com/animal/duck-quack-1.mp3'},{id:'pig',label:'Pig',emoji:'🐷',sound:'https://www.soundjay.com/animal/pig-oink-1.mp3'}], items:[{id:'duck',label:'Duck'},{id:'pig',label:'Pig'}]},
  // World 1 - Words & Spelling (16-20)
  {type:'word', instructions:'Match the word to the picture!', critters:[{id:'apple',label:'🍎',word:'apple'},{id:'ball',label:'⚽️',word:'ball'}], items:[{id:'apple',label:'apple'},{id:'ball',label:'ball'}]},
  {type:'word', instructions:'Match the word to the picture!', critters:[{id:'car',label:'🚗',word:'car'},{id:'dog2',label:'🐶',word:'dog'}], items:[{id:'car',label:'car'},{id:'dog2',label:'dog'}]},
  {type:'spelling', instructions:'Spell the word by dragging letters!', word:'cat'},
  {type:'spelling', instructions:'Spell the word by dragging letters!', word:'dog'},
  {type:'spelling', instructions:'Spell the word by dragging letters!', word:'sun'},
  // World 2 - (21-30)
  {type:'count', instructions:'How many apples? Drag the correct number.', critters:[{id:'apples',label:'🍎🍎🍎'}], items:[{id:'3',label:'3'},{id:'2',label:'2'}]},
  {type:'add', instructions:'Add and drag the sum!', critters:[{id:'sum1',label:'🍎🍎 + 🍎'}], items:[{id:'3',label:'3'},{id:'4',label:'4'}]},
  {type:'size', instructions:'Which is biggest? Drag the correct card to the big one.', critters:[{id:'small',label:'📦'},{id:'big',label:'📦📦📦'}], items:[{id:'big',label:'Big'},{id:'small',label:'Small'}]},
  {type:'pattern', instructions:'Complete the pattern by dragging the missing piece.', critters:[{id:'pattern',label:'🔴🔵🔴❓'}], items:[{id:'🔵',label:'🔵'},{id:'🔴',label:'🔴'}]},
  {type:'opposite', instructions:'Match the opposites!', critters:[{id:'hot',label:'🔥'},{id:'cold',label:'❄️'}], items:[{id:'hot',label:'Hot'},{id:'cold',label:'Cold'}]},
  {type:'habitat', instructions:'Match the animal to its home!', critters:[{id:'fish',label:'🐟'},{id:'bird2',label:'🐦'}], items:[{id:'water',label:'Water'},{id:'tree',label:'Tree'}]},
  {type:'food', instructions:'Match the animal to its food!', critters:[{id:'rabbit',label:'🐰'},{id:'monkey',label:'🐵'}], items:[{id:'carrot',label:'Carrot'},{id:'banana',label:'Banana'}]},
  {type:'emotion', instructions:'Match the face to the emotion!', critters:[{id:'happy',label:'😊'},{id:'sad',label:'😢'}], items:[{id:'happy',label:'Happy'},{id:'sad',label:'Sad'}]},
  {type:'vehicle', instructions:'Match the vehicle to where it belongs!', critters:[{id:'car3',label:'🚗'},{id:'plane',label:'✈️'}], items:[{id:'road',label:'Road'},{id:'sky',label:'Sky'}]},
  {type:'mixed', instructions:'Final mixed challenge! Combine what you learned.', critters:[{id:'red',label:'Red',color:'#e53935'},{id:'circle',label:'Circle',shape:'circle'},{id:'dog',label:'🐶',sound:'https://www.soundjay.com/animal/dog-barking-1.mp3'}], items:[{id:'red',label:'Red'},{id:'circle',label:'Circle'},{id:'dog',label:'Dog'}]}
];

const crittersDiv = document.getElementById('critters');
const itemsDiv = document.getElementById('items');
const msg = document.getElementById('message');
const instr = document.getElementById('instructions');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const retryBtn = document.getElementById('retryBtn');
const startWorld2Btn = document.getElementById('startWorld2Btn');
const world2Unlock = document.getElementById('world2Unlock');
const completion = document.getElementById('completion');
const trophy = document.getElementById('trophy');
const correctSound = document.getElementById('correctSound');
const wrongSound = document.getElementById('wrongSound');

let current = 0;
let dragged = null;

function clearAreas(){ crittersDiv.innerHTML=''; itemsDiv.innerHTML=''; msg.textContent=''; retryBtn.style.display='none'; world2Unlock.style.display='none'; startWorld2Btn.style.display='none'; completion.style.display='none'; trophy.style.display='none'; }

function createDraggable(text, data){
  const card = document.createElement('div');
  card.className = 'item';
  card.tabIndex = 0;
  card.textContent = text;
  card.dataset.value = data;
  card.setAttribute('draggable','true');
  card.addEventListener('dragstart', e=> { dragged = card; e.dataTransfer.setData('text/plain', data); });
  card.addEventListener('touchstart', e=>{ dragged = card; }, {passive:false});
  return card;
}

function createTarget(obj){
  const tgt = document.createElement('div');
  tgt.className = 'critter';
  if(obj.color) tgt.style.background = obj.color;
  tgt.textContent = obj.label || '';
  if(obj.emoji){ tgt.innerHTML = '<div class="emoji">'+obj.emoji+'</div>'; tgt.style.background='#6aa'; }
  tgt.dataset.accept = obj.id || obj.label || obj.word || obj.shape || obj.label;
  tgt.addEventListener('dragover', e=> e.preventDefault());
  tgt.addEventListener('drop', handleDrop);
  return tgt;
}

function playAnimalSound(url){
  if(!url) return;
  const a = new Audio(url);
  a.play();
}

function handleDrop(e){
  e.preventDefault();
  const val = e.dataTransfer.getData('text/plain') || (dragged && dragged.dataset.value);
  const target = e.currentTarget;
  const targetAccept = target.dataset.accept;
  checkAnswer(val, targetAccept);
}

function handleTouchEnd(e){
  const touch = e.changedTouches[0];
  const el = document.elementFromPoint(touch.clientX, touch.clientY);
  if(!el) return;
  const accept = el.dataset && el.dataset.accept;
  const val = dragged && dragged.dataset.value;
  if(accept) checkAnswer(val, accept);
  dragged = null;
}

function checkAnswer(value, targetAccept){
  const stage = stages[current];
  let correct = false;
  if(stage.type==='spelling'){ handleSpellingDrop(value); return; }
  // simple match: value equals targetAccept or value equals targetAccept string
  if(value != null && targetAccept != null){
    correct = (value.toString().toLowerCase() === targetAccept.toString().toLowerCase());
  }
  if(correct){
    msg.textContent = '🎉 Great job!';
    msg.style.color='green';
    correctSound.currentTime = 0; correctSound.play();
    setTimeout(()=>{ current++; if(current>=stages.length){ showCompletion(); } else { loadStage(current); } }, 900);
  } else {
    msg.textContent = '😢 Try again!';
    msg.style.color='crimson';
    wrongSound.currentTime = 0; wrongSound.play();
    retryBtn.style.display='inline-block';
  }
}

function showCompletion(){
  completion.style.display='block';
  trophy.style.display='block';
  correctSound.play();
}

function handleSpellingDrop(letter){
  const bar = document.querySelector('.spelling-bar');
  if(!bar) return;
  const stage = stages[current];
  bar.textContent += letter;
  // remove the dragged element if exists
  if(dragged && dragged.parentNode) dragged.parentNode.removeChild(dragged);
  if(bar.textContent === stage.word){
    msg.textContent='🎉 Correct!';
    correctSound.play();
    setTimeout(()=>{ current++; loadStage(current); },900);
  } else {
    if(bar.textContent.length >= stage.word.length){
      msg.textContent='😢 Not quite — try again.';
      wrongSound.play();
      retryBtn.style.display='inline-block';
    } else {
      msg.textContent='✅ Letter placed';
      correctSound.play();
    }
  }
}

function loadStage(i){
  clearAreas();
  current = i;
  if(current >= stages.length){ showCompletion(); return; }
  const stage = stages[current];
  instr.textContent = stage.instructions;
  document.querySelector('h1').innerHTML = '🎨 Color Critters — Stage <span>' + (current+1) + '</span>';

  // create targets
  if(stage.critters){
    stage.critters.forEach(t=>{
      const tgt = createTarget(t);
      if(stage.type==='animal' && t.sound){
        tgt.style.background = '#ffd6a5';
        tgt.innerHTML = '<div class="emoji">'+t.emoji+'</div>';
        tgt.addEventListener('click', ()=> playAnimalSound(t.sound));
      }
      crittersDiv.appendChild(tgt);
    });
  }

  // create items
  if(stage.items){
    stage.items.forEach(it=>{
      const val = it.id || it.label || it.shape || it;
      const label = it.label || it.shape || it;
      const card = createDraggable(label, val);
      itemsDiv.appendChild(card);
    });
  }

  // spelling stage special UI
  if(stage.type==='spelling'){
    const bar = document.createElement('div');
    bar.className = 'critter spelling-bar';
    bar.style.background='#fff';
    bar.style.color='#246';
    bar.textContent = '';
    crittersDiv.appendChild(bar);
    const letters = stage.word.split('');
    letters.sort(()=>Math.random()-0.5);
    letters.forEach(l=> itemsDiv.appendChild(createDraggable(l,l)));
  }

  // special: unlock world2 after stage 20 (index 19)
  if(current === 19){
    world2Unlock.style.display='block';
    startWorld2Btn.style.display='inline-block';
  }

  // touchend listener for drop
  document.addEventListener('touchend', function te(e){
    if(dragged){ handleTouchEnd(e); }
  }, {passive:false});
}

prevBtn.addEventListener('click', ()=>{ if(current>0) loadStage(current-1); });
nextBtn.addEventListener('click', ()=>{ if(current < stages.length-1) loadStage(current+1); });
retryBtn.addEventListener('click', ()=> loadStage(current));
startWorld2Btn.addEventListener('click', ()=> { loadStage(20); });

loadStage(0);
</script>
</body>
</html>
